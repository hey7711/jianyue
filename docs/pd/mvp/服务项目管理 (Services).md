### PRD: 服务项目管理 (Services)

- PRD ID- PRD-BIZ-6.0
- 功能模块- 服务项目管理
- 负责人- 小白 (PM)
- 更新日期- 2025 年 10 月 21 日

#### 背景与目标

- 背景
  - 服务项目是商家向顾客提供的核心价值载体，是整个预约排班系统的基础数据单元。一个清晰、完整且易于管理的服务项目目录，对于提升顾客在线预约体验、保障后台运营调度的准确性至关重要。
- 目标
  - 基础数据构建: 为商家提供创建和管理单个服务项目（包含名称、价格、时长、介绍、适用员工、缓冲时间、在线状态等）的核心能力。
  - 支撑预约流程: 为顾客端小程序和后台手动预约提供准确的服务选项、时长和可选员工信息。
  - 提升管理效率: 提供列表排序、状态管理（启用/停用）等功能，方便商家组织和维护其服务菜单。
  - 保障数据准确性: 建立服务属性变更的快照规则和删除/停用操作的前置校验，确保系统数据的一致性和运营安全。

#### 用户故事

- 作为一个商户管理员, 我想要能方便地添加新的服务项目，并设定其名称、价格、所需时长、服务介绍、服务前后所需的准备/清理时间、可以提供该服务的员工以及是否允许顾客在线预约, 以便全面定义我的服务产品，并为精准的在线预约和排班提供基础信息。
- 作为一个商户管理员, 我想要能通过拖拽来调整服务项目的展示顺序, 以便在后台和顾客端小程序中优先展示主推项目。
- 作为一个商户管理员, 我想要能“启用”或“停用”一个服务项目, 以便灵活控制哪些服务当前可供预约，同时保留项目信息。
- 作为一个商户管理员, 我想要能查看我店铺当前提供的所有服务项目列表, 以便我能对服务菜单进行概览和管理。
- 作为一个商户管理员, 我想要能方便地修改一个已存在的服务项目的信息, 以便使服务菜单与店铺的实际运营保持一致。
- 作为一个商户管理员, 我想要能删除一个不再提供的服务项目, 以便保持服务菜单的简洁和有效性。

#### 功能范围

- In Scope (本次需求范围)
  - 增、删、改、查单个服务项目。
  - 设置服务项目核心属性：名称、价格、服务时长、准备/清理缓冲时间、服务介绍。
  - 为服务项目指定可提供的员工（多选）。
  - 设置服务项目是否允许顾客在线预约（开关）。
  - 管理服务项目的状态（启用/停用）。
  - 支持服务项目列表的手动拖拽排序。
- Out of Scope (本次需求范围之外)
  - 服务项目的分类/分组功能。
  - 套餐/服务组合功能。
  - 服务项目的图片/视频上传。
  - 针对不同会员等级设置不同服务价格。

#### 流程设计

- 核心流程
  - 创建: 进入服务项目管理 -> 点击添加 -> 填写完整信息（含指定员工、在线开关等）-> 保存。
  - 管理: 列表页浏览 -> 拖拽排序 / 点击操作 -> 编辑 / 停用 / 启用 / 删除（执行校验）。

#### 页面与功能详述

- 页面一- 服务项目管理

  - 页面布局
    - 页面标题- 服务项目管理
    - 主操作按钮- [ + 添加服务 ]
    - 内容区 (服务项目列表 - 支持拖拽排序)-
      - 表头- [ (拖拽图标) ] [ 服务名称 ] [ 服务价格 ] [ 总时长 ] [ 线上预约 ] [ 状态 ] [ 操作 ] (增加“线上预约”列)
      - 列表行 (示例)-
        - 拖拽图标- [ :: ]
        - 服务名称- 高级染烫造型
        - 服务价格- ¥ 688.00
        - 总时长- 225 分钟
        - 线上预约- ✅ (或 [开]/[关] 图标/文字)
        - 状态- [ 启用中 ] (绿色)
        - 操作- [ 编辑 ] [ 停用 ] [ 删除 ]
    - 列表说明文字- "拖动 [::] 图标可调整服务项目在顾客端的展示顺序。列表默认按创建时间倒序排列。"
  - 功能逻辑
    - 列表展示: 清晰展示各列信息。“总时长”为 服务时长 + 准备时间 + 清理时间。“线上预约”列直观展示该服务是否对顾客端开放。
    - 排序: 支持用户通过拖拽 [::] 图标调整服务顺序。拖拽完成后，系统自动保存新的排序结果，无需额外点击保存按钮。此顺序将应用于后台列表和顾客端小程序服务列表。列表默认按创建时间倒序排列。
    - 操作: 根据服务状态（启用中/已停用）动态显示可执行的操作（停用/启用）。

- 组件二- 添加/编辑服务项目 (模态框)

  - 页面布局
    - 标题- 添加新服务 / 编辑服务项目
    - 表单-
      - 服务名称 (必填)
      - 服务价格 (必填, 非负数)
      - 服务时长 (必填, 5-480 分钟, 5 的倍数)
      - 服务前准备时间 (可选, 0-60 分钟, 5 的倍数)
      - 服务后清理时间 (可选, 0-60 分钟, 5 的倍数)
      - 动态总时长预览: (在时长输入区域下方) "总计占用时长：XXX 分钟"
      - 服务介绍 (可选, 多行文本)
      - 可提供此服务的员工 (必选, 多选列表/穿梭框)
      - 允许顾客在线自助预约 (开关, 默认开启)
    - 安全提示 (仅编辑时显示)- "请放心修改：服务项目的名称、价格、时长等变更仅对之后新创建的预约生效，不会影响已存在的预约。"
  - 功能逻辑
    - 所有必填项需校验。时长、缓冲时间需符合范围和倍数要求。
    - “总计占用时长”根据三个时长字段实时计算并显示。
    - “可提供此服务的员工”列表仅展示状态为“正常”的团队成员。

- 组件三- 停用/启用服务项目 (确认模态框)

  - 页面布局
    - 停用确认: 标题(“确认停用”), 提示图标, 说明文字(“您确定要停用...吗？”), 辅助说明(“停用后将无法为该服务创建新的预约...”), 操作按钮([取消]/[确认停用])。
    - 启用确认: 标题(“确认启用”), 说明文字(“您确定要重新启用...吗？”), 操作按钮([取消]/[确认启用])。
  - 功能逻辑
    - 用户确认后，更新服务项目状态。

- 组件四- 删除服务项目 (确认模态框)

  - 页面布局
    - 标题(“确认删除”), 危险警告图标, 说明文字(“您确定要永久删除...吗？”), 辅助说明(“此操作不可恢复！...”), 操作按钮([取消]/[确认删除])。
  - 功能逻辑
    - 点击`[ 确认删除 ]`前，系统必须执行未来预约校验。

- 组件五- 删除失败提示 (信息模态框 - 优化版)
  - 页面布局
    - 标题(“操作失败”), 错误图标, 说明文字(“删除失败...已被以下 X 条预约使用...”), 列出冲突预约示例, 辅助说明(“您可以前往 [预约日历] ...”), 操作按钮([我知道了])。
  - 功能逻辑
    - 清晰告知用户删除失败的原因及后续处理建议。

#### 核心业务规则

- 状态影响规则:

  - 只有状态为“启用”的服务项目，才能：
    - 在顾客端小程序的服务列表中展示（若“允许在线预约”也为开启）。
    - 在后台手动创建预约时被选择。
  - 停用操作不影响任何已存在的预约单。

- 数据一致性与快照规则:

  - 基础原则: 服务项目的任何属性变更（包括名称、价格、服务时长、准备时间、清理时间、介绍）均不影响任何已经创建的预约单。预约单在创建时已快照存储相关信息。
  - “可提供员工”变更的特殊处理:
    - 快照: 修改服务项目的“可提供此服务的员工”列表，同样不会自动修改任何已存在的预约单中已分配的服务人员。
    - 【极其重要】前置校验: 在管理员保存对“可提供此服务的员工”列表的修改之前，系统必须执行以下校验：
      - 检查是否有任何未来的（今天及以后）、状态为“待确认”或“已确认”的预约单，其关联的服务项目是当前正在编辑的这个服务，并且其分配的服务人员正好是本次将要被从列表中移除的员工。
      - 若存在冲突: 系统必须阻止保存本次编辑操作，并弹出一个类似删除失败的提示框，内容为：“保存失败。您试图移除的员工‘[员工姓名]’在未来仍有 X 条使用此服务的预约。请先将这些预约取消或改派给其他仍然符合资格的员工后，再进行修改。” 提示框中应提供快捷链接 `[ 查看并处理这些预约 ]`，引导管理员解决冲突。
      - 若无冲突: 允许保存修改。

- 删除前置校验:

  - 在执行永久删除操作前，系统必须校验是否存在任何未来的（今天及以后）、状态为“待确认”或“已确认”的预约单关联了此服务项目。若存在，则阻止删除并提示用户。

- 员工状态变更联动规则:

  - 自动移除: 当一个团队成员（员工）在“团队管理”模块中状态变为“已停用”时，系统必须自动将该成员从所有服务项目的“可提供此服务的员工”列表中移除。
  - 数据同步: 此规则确保了服务项目的可指派员工列表始终只包含当前有效的团队成员。
  - （关联规则 - 需在团队管理 PRD 中体现）: 建议在执行“停用”员工操作前，系统检查该员工是否是某些服务的唯一可提供者，并向管理员发出警告。

- （前瞻性）与模板关联规则:

  - 当一个服务项目被“停用”时，系统应检查是否有任何仅包含此服务的次卡模板或套餐模板（未来功能）。若有，这些模板的状态应自动变为“不可售卖”。服务重新启用时，这些模板自动恢复可售卖状态。

- 排序规则:
  - 列表默认按创建时间倒序排列。用户可通过拖拽手动排序，该顺序同时应用于后台和顾客端。

#### 成功指标

- 配置完整度- 完成 Onboarding 的商家中，创建了至少 3 个启用的服务项目的比例 > 90%。
- 核心字段使用率- 在所有启用的服务项目中，设置了非零“服务时长”和至少指定了一名“可提供员工”的比例达到 100%。设置了“服务介绍”的比例 > 50%。
- 操作效率- 用户完成“添加一个包含所有必填信息的新服务项目”的平均操作时长 < 1 分钟。
