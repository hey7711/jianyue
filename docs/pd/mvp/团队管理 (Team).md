### PRD: 团队管理 (Team)

- PRD ID- PRD-BIZ-3.0
- 功能模块- 团队管理
- 负责人- 小白 (PM)
- 更新日期- 2025 年 10 月 20 日

#### 背景与目标

- 背景
  - 团队是商家提供服务的核心载体，团队成员及其可用时间是整个预约系统的基石。一个清晰、高效的团队与排班管理功能，是解决商家组织架构混乱、排班效率低下等核心痛点的关键，也是我们所有上层业务（如预约、统计）得以正常运转的前提。
- 目标
  - 为商家提供一个集中管理所有员工账户、角色和权限的中心。
  - 提供一个直观、可视化的排班工具，帮助商家轻松设定和管理员工的可用工作时间，为顾客端的在线预约提供准确的数据基础。
  - 验证并落地我们预设的“商户管理员、运营人员、服务人员”三层角色体系，确保不同角色的员工能在清晰的权限边界内高效协作。

#### 用户故事

- 作为一个商户管理员, 我想要能方便地添加、查看、修改和停用我的员工账户, 以便让我的团队成员都能使用系统，并确保员工信息与店铺的实际人事情况保持一致。
- 作为一个商户管理员, 我想要能通过姓名或手机号快速搜索员工，并能按角色进行筛选, 以便在团队人数增多时，能高效地找到并管理特定成员。
- 作为一个商户管理员, 我想要能重新激活一个已停用的员工账户, 以便当员工返聘时，可以恢复其账户和历史数据，而无需创建新账户。
- 作为一个商户管理员, 我想要在添加或编辑员工时，能为他们分配合适的角色（运营人员或服务人员）, 以便授予他们完成工作所需的最小系统权限，确保店铺数据的安全。
- 作为一个既是老板又是核心技师的商户管理员, 我想要为自己设置排班并接受顾客的预约, 以便我的时间也能被系统统一管理。
- 作为一个商户管理员, 我想要在创建新员工账户后，能方便地复制其初始登录信息, 以便我可以通过私密渠道手动发送给他们，既保证了安全又控制了成本。
- 作为一个商户管理员或运营人员, 我想要在一个可视化的排班界面上，为我的服务人员设置每周重复的固定班次，并能在班次中设定固定的午休等休息时段, 以便系统能准确地计算出真正可供顾客预约的时间。
- 作为一个商户管理员或运营人员, 我想要能方便地为员工添加临时的请假或调休安排, 以便及时锁定他们的不可用时间，避免发生预约冲突。
- 作为一个商户管理员, 我想要能为任何角色的员工（包括我自己、运营人员、服务人员）开启“提供预约服务”的选项, 以便灵活地将他们设置为可被排班和预约的服务资源。
- 作为一个商户管理员, 我想要为我的开启了“提供服务”的团队成员编辑他们的个人档案信息（如头像、昵称、简介、擅长项目、性别、排序值等）, 以便在顾客端小程序中更好地展示他们，提升预约转化率。

#### 功能范围

- In Scope (本次需求范围)
  - 增、删（停用/重新激活）、改、查员工账户。
  - 在员工列表中按姓名/手机号搜索，并按角色筛选。
  - 为员工分配“运营人员”或“服务人员”角色，并能独立设置其是否提供预约服务。
  - 创建员工后手动复制初始登录凭证。
  - 可视化的周视图排班管理。
  - 设置每周重复的固定班次，并能在班次中添加休息时段。
  - 在排班中添加临时的请假/调休。
  - 为所有角色的员工独立设置其是否“提供预约服务”（开关）。
  - 编辑开启了“提供服务”的员工的服务人员档案 (ServiceProviderProfile)信息（头像、昵称、性别、职称、年限、简介、擅长、排序值）
- Out of Scope (本次需求范围之外)
  - 复杂的、自定义的角色与权限配置。
  - 员工的考勤与薪酬计算。
  - 跨夜班次的排班设置。

#### 流程设计

- 员工管理流程
  - 管理员进入“员工列表” -> 点击“添加员工” -> 填写信息并保存 -> 在成功弹窗中复制登录凭证 -> 手动分享给员工 -> 员工使用凭证激活账户。
  - 管理员编辑员工 -> 可修改角色、是否提供服务开关 -> 若开启服务，则可编辑`服务人员档案`信息 -> 保存。
- 排班管理流程
  - 管理员/运营点击主导航中的`排班` -> 在员工对应的日期单元格点击 -> 设置班次时间、休息时段及重复规则 -> 保存后班次生效 -> 如需调整，可点击班次卡片进行修改或添加请假。
  - 管理员在“员工列表”页面 -> 点击某员工操作列的`[ 查看排班 ]` -> 页面跳转至独立的“排班管理”页面，并自动滚动及高亮显示该员工所在的行。

#### 页面与功能详述

- 页面一- 员工管理 (主页面)

  - 页面标题: 员工管理 (作为独立页面，主导航入口为 `员工`)
  - 页面布局
    - 工具栏-
      - 搜索框- (占位符：按姓名或手机号搜索)
      - 角色筛选器- (下拉菜单：全部角色、商户管理员、运营人员、服务人员)
      - 视图筛选器- (下拉菜单：显示正常员工、显示已停用员工)
    - 主操作按钮- [ + 添加员工 ]
    - 内容区 (员工列表)-
      - 表头- [ 姓名 ] [ 角色 ] [ **提供服务** ] [ 手机号 ] [ 状态 ] [ 操作 ]
      - 列表行- 展示员工信息，操作列包含`[ ... ]`按钮。
  - 功能逻辑
    - 搜索与筛选:
      - 当管理员在搜索框中输入文字时，下方的员工列表会实时（进行防抖处理）根据姓名或手机号进行模糊匹配，并刷新结果。
      - 当管理员在角色筛选器中选择一个角色时，列表会立即刷新，只显示符合该角色的员工。
      - 搜索和筛选功能可以组合使用。
    - 视图筛选:
      - 默认视图为“正常员工”，列表中包含状态为“正常”和“待激活”的员工。
      - 管理员可从下拉菜单中切换至“已停用员工”视图，查看所有被停用的历史员工。
    - 操作列:
      - 在“正常员工”视图下，操作菜单包含“编辑”、“查看排班”、“停用”。
      - 在“已停用员工”视图下，操作菜单仅包含“重新激活”。
    - 快捷操作交互:
      - 当管理员点击某员工的 `[ 查看排班 ]` (仅对开启了“提供服务”者显示) 选项时，页面应跳转至独立的“排班管理”页面，并自动滚动及高亮显示该员工所在的行，同时让该行高亮显示（例如，背景色短暂变为淡黄色后恢复），以起到视觉引导作用。
    - 重新激活流程:
      - 当管理员点击 `[ 重新激活 ]` 时，系统必须先校验该已停用员工的手机号是否与当前任何活跃员工的手机号冲突。
      - 若无冲突: 系统弹出一个确认框：“您确定要重新激活该员工吗？” 确认后，该员工的状态恢复为“正常”，并从“已停用”列表移回“正常员工”列表。
      - 若存在冲突: 系统阻止恢复操作，并弹出一个提示框，内容为：“恢复失败。该员工的手机号 [手机号] 已被另一位活跃员工使用。请先修改冲突的活跃员工手机号（推荐），或编辑此已停用员工的手机号后，再尝试恢复。” （明确引导用户可编辑已停用员工手机号）。
    - 停用流程:
      - 当管理员点击 `[ 停用 ]` 时，系统必须首先检查该员工名下是否存在任何未来的（今天及以后）、状态为“待确认”或“已确认”的预约。
      - 若不存在未来预约：系统会弹出一个标准确认框：“您确定要停用该员工吗？停用后他们将无法登录。” 确认后，员工状态变为“已停用”。
      - 若存在未来预约：系统将禁止直接停用，并弹出一个提示框，内容为：“操作失败。该员工名下仍有 X 条未来的预约，请先将这些预约取消或改派给其他员工后，再进行停用操作。” 提示框中应提供一个快捷链接 `[ 查看并处理这些预约 ]`，点击后直接跳转到以该员工为筛选条件的预约日历界面。

- 组件二- 添加/编辑员工 (模态框)

  - 页面布局
    - 标题- 添加新员工 / 编辑员工信息
    - 表单-
      - 基础信息区:
        - 姓名 (输入框, 必填)
        - 手机号 (输入框, 必填, 根据状态决定是否可编辑)
        - 角色 (下拉菜单, 必填, 选项：商户管理员 / 运营人员 / 服务人员) (编辑自己时角色不可改)
        - 是否提供预约服务 (开关/复选框)
          - 标签- 允许顾客预约此员工的服务 (默认开启)
          - 提示- 开启后，您才能在“排班管理”中为他排班，并完善下方介绍信息。
      - 服务人员介绍 (仅当“是否提供预约服务”开关开启时显示):
        - 标题- 服务人员介绍
        - 说明- _此信息将展示给顾客，帮助他们选择合适的服务人员。_
        - 头像上传/预览控件 (可选)
        - 昵称/称呼 (输入框, 可选)
        - 性别 (下拉菜单, 可选, 选项：男/女/未指定)
        - 职称/头衔 (输入框, 可选)
        - 工作年限 (数字输入框, 可选)
        - 个人简介 (多行文本输入框, 可选)
        - 擅长项目 (多行文本输入框, 可选)
        - 排序值 (数字输入框, 可选, 默认 0)
  - 功能逻辑
    - 添加新员工时，所有字段可编辑，“是否提供预约服务”默认为开启。
    - 编辑员工时，管理员仅可修改其姓名、角色和是否提供预约服务。
    - 手机号编辑规则:
      - 添加新员工时: 手机号可编辑。
      - 编辑“正常”或“待激活”状态的员工时: 手机号作为唯一登录凭证，只读不可修改。
      - 编辑“已停用”状态的员工时: 手机号允许被修改，以便管理员在恢复前解决潜在的手机号冲突。
    - 服务介绍的显示/隐藏: 根据“是否提供预约服务”开关的状态动态显示/隐藏。
    - 数据关联: 保存时，如果“是否提供预约服务”开关是开启的：
      - 若对应的`ServiceProviderProfile`不存在，则自动创建该记录并保存档案信息。
      - 若已存在，则更新档案信息。
      - 如果开关从关->开，且档案不存在，则创建。
    - 关闭服务开关的处理: 如果开关从开->关，保存时，不清空已填写的`ServiceProviderProfile`信息（以便下次开启时恢复），但该员工将不再出现在排班视图和顾客端。
    - 基础信息编辑: 添加时全可编辑。编辑时手机号只读。编辑自己时角色不可改（防止误操作失去管理员权限）。
    - 校验: 所有必填项校验，手机号格式校验。保存时需校验手机号在活跃员工中的唯一性（编辑已停用员工时，允许修改为与其他已停用员工重复的手机号，但在尝试恢复时会触发冲突校验）。

- 组件三- 添加成功 & 复制凭证 (模态框)

  - 页面布局
    - 标题- 添加成功！
    - 内容- 展示新员工的“登录手机号”和系统生成的“临时密码”。
    - 安全提示- “为保障安全，此临时密码仅会显示一次，请立即复制并分享给您的员工。”
    - 按钮- [ 复制信息 ] [ 完成 ]
  - 功能逻辑
    - 点击`[ 复制信息 ]`，会将一段包含登录地址、手机号和密码的预设文本复制到剪贴板。

- 页面四- 排班管理 (主页面)

  - 页面标题: 排班管理 (作为独立页面，主导航入口为 `排班`)
  - 页面布局
    - 顶部工具栏- 周切换导航。
    - 主内容区- 可视化排班日历，每行代表一位开启了“提供服务”的员工，每列代表一天。
  - 功能逻辑
    - 排班视图仅会显示开启了“允许顾客预约此员工的服务”开关的团队成员，无论其角色是什么。
    - 点击空白单元格，弹出“设置班次”模态框。
    - 点击已有的班次或请假卡片，可进行编辑或删除。

- 组件五- 设置班次 (模态框)

  - 页面布局
    - 标题- 设置班次
    - 表单- 上班时间、下班时间。
    - 休息时段区-
      - 标题- 休息时段
      - 列表- (显示已添加的休息时段，如 “午休: 12:00 - 13:00”)
      - 按钮- `[ + 添加休息时段 ]`
    - 重复规则（周一至周日复选框）。
  - 功能逻辑
    - 点击 `[ + 添加休息时段 ]` 可以增加一条或多条休息时间段（包含开始时间和结束时间），且休息时段必须在上班时间内。
    - 保存时，系统会校验设置的班次时间是否与该员工已有的预约产生冲突。若冲突，则禁止保存并提示用户。

- 组件六- 添加休假/请假 (模态框)
  - 页面布局
    - 标题- 添加休假/请假
    - 表单-
      - 类型 (下拉菜单，选项：请假、调休)
      - 开始时间 (时间选择器)
      - 结束时间 (时间选择器)
  - 功能逻辑
    - 可通过点击排班日历的空白处，或点击已有班次卡片上的菜单来触发此模态框。
    - 保存时，系统会对所选时间段进行预约冲突检测。

#### 核心业务规则

- 员工管理规则
  - 账户安全: 活跃员工的登录手机号在创建后不可修改。已停用员工手机号可修改以解决恢复冲突。
  - 防锁死机制: 系统中最后一位“商户管理员”角色的员工，不能被停用，也不能被降级为其他角色，以防止商家账户无人管理。
  - 员工停用处理流程:
    - 步骤 1 - 预约校验: 为防止运营事故，当管理员试图停用一个员工时，系统必须首先校验其是否存在任何未来的、未完成的预约（状态为“待确认”或“已确认”）。若存在，系统必须阻止停用操作，并引导管理员先行处理这些冲突的预约。
    - 步骤 2 - 排班清理: 当员工被成功停用后（即已处理完所有未来预约），系统必须自动删除其所有未来的（从停用当天及以后）排班记录，包括固定班次、休息时段和临时请假。历史排班记录应予以保留，以用于未来的数据分析。
    - 步骤 3 - 服务关联清理: 同时，系统必须自动将该已停用成员从所有 `服务项目` 的“可提供此服务的员工”列表中移除。此操作确保已停用的员工不再能被指派新的服务预约。
- 排班规则
  - 排班资格: 只有开启了“是否提供预约服务”开关的团队成员，才会出现在排班视图中，并可被排班。
  - 冲突检测: 任何对排班的修改（如缩短工时、删除班次、增加请假/休息时段）都必须进行冲突检测。若修改的时间段内已存在任何状态（包括‘待确认’和‘已确认’）的预约，该操作将被系统阻止，并提示用户先处理相关预约。
  - 重复班次删除逻辑: 当删除一个重复班次时，系统需向用户确认：“您是想仅删除今天这一个班次，还是删除此后所有的重复班次？”。
  - 重要约束: 所有排班（包括班次和休息时段）的设置时间，都必须在店铺设置的‘营业时间’范围内。

#### 成功指标

- 团队配置率- 完成 Onboarding 的商家中，添加了至少一名除自己以外员工的比例 > 70%。
- 排班配置率- 所有开启了“提供预约服务”的团队成员中，被设置了未来一周固定排班的比例 > 90%。
- 操作效率- 用户完成“为一名新员工设置好未来一周固定排班（含午休）”的平均操作时长 < 2 分钟。
