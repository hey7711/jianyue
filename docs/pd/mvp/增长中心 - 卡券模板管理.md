### PRD: 增长中心 - 卡券模板管理

-   PRD ID- PRD-BIZ-5.0
-   功能模块- 增长中心 - 卡券模板管理
-   负责人- 小白 (PM)
-   更新日期- 2025年10月21日

#### 背景与目标

-   背景
    -   卡券模板是商家设计和管理其预付费营销产品（如次卡、储值卡）的基础。它是连接商家营销策略与会员实际购买、使用的桥梁，是实现“增长伙伴”定位 的核心功能之一。提供一个简单、灵活的模板管理工具，对驱动商家付费意愿、支撑会员管理和结算流程至关重要。
-   目标
    - 赋能商家: 为商户管理员提供创建和管理次卡、储值卡两种核心预付费产品模板的能力。
    - 支撑核心流程: 为“会员管理”模块中的“办理/充值卡券”功能提供可选的卡券产品基础。
    - 验证增长价值: 落地MVP阶段的核心付费驱动功能，让商家可以通过设计卡券产品来提升锁客率和现金流。
    - 易用性: 提供清晰、直观的操作界面，符合“极致易用”的产品原则，降低商家使用门槛。

#### 用户故事

-   作为一个商户管理员, 我想要能方便地创建不同类型的卡券模板（如次卡、储值卡）, 以便设计出符合我店铺经营需求的预付费产品。
-   作为一个商户管理员, 我想要在创建次卡模板时，能设定包含的服务次数、售价、有效期规则，并能添加备注说明, 以便清晰地定义次卡的价值、使用限制和管理信息。
-   作为一个商户管理员, 我想要在创建储值卡模板时，能设定储值面额、赠送金额（可选）、售价、有效期规则，并能添加备注说明, 以便设计出吸引顾客预存资金的方案。
-   作为一个商户管理员, 我想要能查看、修改我已创建的卡券模板信息（如价格、有效期、备注）, 以便根据市场反馈或促销活动调整卡券内容。
-   作为一个商户管理员, 我想要能“停用”一个不再售卖的卡券模板, 以便运营人员在给会员办卡时不会误选到旧的或已下架的产品，同时不影响已售出卡券的使用。
-   作为一个商户管理员, 我想要能方便地找到并“重新启用”一个已停用的卡券模板, 以便在需要时（如活动复刻）快速恢复售卖。
-   作为一个商户管理员, 我想要在模板列表中就能快速看到每个模板的核心规则（如次数、面额）和最后更新时间, 并且能通过名称搜索或按类型/状态筛选，以便在模板增多时高效地进行管理。
-   作为一个商户管理员, 我想要在模板列表中看到基于每个模板当前已售出且仍然有效的卡券数量, 以便我能快速了解各个模板的受欢迎程度和市场表现。

#### 功能范围

-   In Scope (本次需求范围)
    - 创建、编辑、停用、重新启用次卡和储值卡模板。
    - 为模板设置名称、核心规则（次数/面额/赠送）、售价、有效期规则（永久/购买后N天月年/固定日期前）、备注说明。
    - 模板列表支持按名称搜索，按类型（次卡/储值卡）和状态（有效/已停用）筛选。
    - 模板列表展示核心规则、状态、最后更新时间、当前有效卡券售出数量等关键信息。
-   Out of Scope (本次需求范围之外)
    - 商家自定义卡券外观样式。
    - 次卡模板指定适用服务项目（MVP 暂不支持）。
    - 复杂的组合型或阶梯式卡券模板。
    - 物理删除卡券模板。

#### 流程设计

-   核心流程
    - 创建: 进入增长中心 -> 点击新建 -> 选择类型 -> 填写信息 -> 保存。
    - 管理: 列表页浏览/搜索/筛选 -> 找到目标模板 -> 点击操作 -> 编辑/停用/重新启用。

#### 页面与功能详述

-   页面一- 增长中心 - 卡券模板管理
    -   页面布局
        - 页面标题- 增长中心
        - 页面内导航- [ 卡券模板 ] (默认激活)
        - 顶部工具栏-
            - 搜索框- (占位符：按模板名称搜索)
            - 类型筛选器- (下拉菜单：全部类型、次卡、储值卡)
            - 状态筛选器- (下拉菜单：有效模板、已停用模板)
        - 主操作按钮- [ + 新建模板 ]
        - 内容区 (卡券模板列表)-
            - 表头- [ 模板名称 ] [ 类型 ] [ 核心规则 ] [ 售价 ] [ 有效卡券 ] [ 状态 ] [ 最后更新时间 ] [ 操作 ] (新增“有效卡券”列)
            - 列表行 (示例1 - 有效次卡)-
                - 模板名称- [次卡图标] 10次经典剪发卡
                - 类型- 次卡
                - 核心规则- 共 10 次
                - 售价- ¥ 750.00
                - 有效卡券- 85 张
                - 状态- [ 有效 ] (绿色)
                - 最后更新时间- 2025-10-21 10:00
                - 操作- [ ... ] (-> 编辑 / 停用)
            - 列表行 (示例2 - 已停用储值卡)-
                - 模板名称- [储值卡图标] 金秋储值特惠
                - 类型- 储值卡
                - 核心规则- 面额 ¥1000 + 赠 ¥200
                - 售价- ¥ 1000.00
                - 有效卡券- 120 张
                - 状态- [ 已停用 ] (灰色)
                - 最后更新时间- 2025-09-30 15:30
                - 操作- [ ... ] (-> 编辑 / 重新启用)
    -   功能逻辑
        - 列表展示: 清晰展示各列信息，不同类型可通过图标辅助区分。“核心规则”列根据类型动态展示内容。“最后更新时间”记录模板创建或最后一次编辑的时间。
        - 搜索与筛选: 支持实时模糊搜索和下拉筛选，可组合使用。
        - 有效卡券: 此列显示当前系统中，基于该模板创建且状态为“有效 (Active)”的`卡券实例`的数量。该数据用于帮助商家评估模板的市场表现和存量情况。
        - 操作: 根据模板状态（有效/已停用）动态显示可执行的操作。

-   组件二- 选择模板类型 (模态框)
    -   页面布局
        - 标题- 选择您要创建的卡券类型
        - 选项一 (卡片)- 次卡 (图标+标题+描述)
        - 选项二 (卡片)- 储值卡 (图标+标题+描述)
    -   功能逻辑
        - 点击卡片后进入对应类型的创建表单。

-   组件三- 创建/编辑 次卡模板 (模态框)
    -   页面布局
        - 标题- 创建次卡模板 / 编辑次卡模板
        - 表单- 模板名称(必填), 包含次数(必填, 正整数), 售价(必填, 非负数)。
        - 适用服务提示: 在“包含次数”下方增加小字提示：“*当前默认适用于所有服务项目。未来将支持指定适用项目。*”
        - 有效期规则选择区 (必填)-
            - [ ] 永久有效
            - [ ] 购买后 [输入框] [天/月/年] 内有效
            - [ ] 固定日期 [日期选择器] 前有效
        - 备注说明 (选填, 多行文本)。
        - 安全提示 (仅编辑时显示): 在底部操作按钮上方增加提示：“请放心修改：模板的任何变更仅对之后新售出的卡券生效，不会影响已售出的卡券。”
    -   功能逻辑
        - 所有必填项需校验。
        - 保存时执行基础逻辑校验（如次数>0, 售价>=0）。

-   组件四- 创建/编辑 储值卡模板 (模态框)
    -   页面布局
        - 标题- 创建储值卡模板 / 编辑储值卡模板
        - 表单- 模板名称(必填), 储值面额(必填, 正数), 赠送金额(可选, 非负数), 售价(必填, 非负数)。
        - 动态提示- (根据面额和赠送金额) “顾客账户将增加 X 元”
        - 有效期规则选择区 (必填)- (同次卡)
        - 备注说明 (选填, 多行文本)。
        - 安全提示 (仅编辑时显示): (同次卡编辑)
    -   功能逻辑
        - 所有必填项需校验。
        - 保存时执行基础逻辑校验（如面额>0, 售价>=0, 面额+赠送>=售价）。

-   组件五- 停用/重新启用模板 (确认模态框)
    -   页面布局
        - 停用确认: 标题(“确认停用”), 提示图标, 说明文字(“您确定要停用...吗？”), 辅助说明(“停用后将无法售卖新卡，但不影响已售出卡券使用。”), 操作按钮([取消]/[确认停用])。
        - 重新启用确认: 标题(“确认启用”), 说明文字(“您确定要重新启用...吗？”), 操作按钮([取消]/[确认启用])。
    -   功能逻辑
        - 用户确认后，更新模板状态。

#### 核心业务规则

-   模板与实例的关系:
    - 快照原则: 卡券实例（`CardInstance`）在创建时，必须将所依据的卡券模板（`CardTemplate`）的核心规则（如有效期规则、次数、面额、赠送金额等）进行快照存储。
    - 修改隔离: 对卡券模板的任何修改（包括编辑内容或停用/启用状态），永远不会影响任何已经售出的卡券实例。已售卡券实例按其创建时的快照规则执行。
-   有效期规则:
    - MVP仅支持“永久有效”、“购买后N[天/月/年]内有效”、“固定日期前有效”三种类型。
    - 系统需根据模板规则，在创建卡券实例时准确计算并存储其`expiry_date`。
-   数据完整性:
    - 不可删除: 为保证历史数据的可追溯性，不允许物理删除任何卡券模板，仅提供“停用”操作。

#### 成功指标

-   功能使用率- 专业版商家中，创建了至少一个自定义卡券模板的比例 > 80%。
-   模板多样性- 平均每个活跃商家创建的有效卡券模板数量 > 2个。
-   操作效率- 用户完成“创建一个包含有效期和备注的次卡模板”的平均操作时长 < 1.5分钟。
