### PRD: 统计与设置 (Analytics & Settings)

-   PRD ID- PRD-BIZ-7.0
-   功能模块- 统计与设置
-   负责人- 小白 (PM)
-   更新日期- 2025年10月21日

#### 背景与目标

-   背景
    -   “统计”模块旨在为商家提供核心经营数据的概览，帮助其了解业务状况。“设置”模块则提供了店铺基础信息、预约规则、推广工具等关键配置项，是保障系统正常运转和符合商家个性化需求的基础。这两个模块共同构成了商家后台管理的核心支撑。
-   目标
    - 数据洞察 (统计): 提供简洁、直观的核心经营指标（营业额、订单数）概览，支持按日/周/月维度查看。
    - 基础配置 (设置): 允许商家配置店铺关键信息（名称、Logo、地址、营业时间、时区），确保信息准确完整。
    - 推广支持 (设置): 提供获取店铺小程序码和链接的便捷途径，助力商家自主推广。
    - 规则定义 (设置): 允许商家配置核心预约规则（时间间隔、提前/最远可约、取消时限、周开始日），保障预约流程的顺畅与合理性。
    - 个性化 (设置): 提供自定义核心系统称谓的功能，提升产品贴合度与用户体验。

#### 用户故事

-   统计
    -   作为一个商户管理员或运营人员, 我想要能快速查看“今日”、“本周”、“本月”的核心经营数据（如营业额、订单数）, 以便我能及时了解店铺的经营状况，做出数据驱动的决策。
-   设置
    -   作为一个商户管理员, 我想要能方便地设置和修改我店铺的名称、Logo、地址、营业时间和时区, 以便在顾客端小程序中展示统一、准确、专业的品牌形象及基础信息。
    -   作为一个商户管理员, 我想要能轻松获取我店铺专属的小程序推广码和链接, 以便我可以方便地分享给顾客，引导他们进行在线预约。
    -   作为一个商户管理员, 我想要设定预约时间间隔、顾客最早/最远可预约的时间、以及顾客可自助取消预约的时限, 以便精细化管理预约流程，平衡顾客便利性与商家运营需求。
    -   作为一个商户管理员, 我想要设定每周的开始日（周一或周日）, 以便确保统计报表中的“本周”数据和日历视图符合我的运营习惯。
    -   作为一个商户管理员, 我想要能将系统默认的核心名词（如“员工”）自定义为更符合我行业习惯的称呼（如“技师”）, 以便让后台界面感觉更亲切、更专业。

#### 功能范围

-   In Scope (本次需求范围)
    - 统计: 查看今日/本周/本月的营业额、完成订单数。
    - 设置:
        - 配置店铺信息：Logo、名称、电话、地址、营业时间（按周重复）、时区。
        - 获取店铺小程序码（自动生成）和链接。
        - 配置预约规则：时间间隔、最早提前、最远可约、取消时限、周开始日。
        - 自定义核心称谓：员工、服务项目、会员。
-   Out of Scope (本次需求范围之外)
    - 统计: 更详细的数据报表（如按员工、按服务项目统计）、趋势图、数据导出。
    - 设置: 多门店管理相关设置、支付相关设置、更复杂的营业时间（如分段）、节假日特殊营业时间。

#### 流程设计

-   核心流程
    - 查看统计: 进入统计页面 -> 切换时间维度查看数据。
    - 配置设置: 进入设置概览页 -> 选择具体设置项 -> 修改信息/规则 -> 保存生效。
    - 获取推广: 进入店铺推广页面 -> 下载图片 / 复制链接。

#### 页面与功能详述

-   页面一- 统计 (Analytics)
    -   页面布局
        - 页面标题- 统计
        - 时间筛选器- [ 今日 ] [ 本周 ] [ 本月 ]
        - 数据卡片区- 显示所选时间维度的“营业额”和“完成订单数”。
    -   功能逻辑
        - 指标定义:
            - 营业额: 指所选时间段内，所有状态更新为“已完成”的`预约单`所快照存储的`服务价格`的总和。无论支付方式，均按服务原价计入。不含售卡/充值金额。
            - 完成订单数: 指所选时间段内，状态更新为“已完成”的`预约单`数量。
        - 时间范围定义:
            - 今日: 指当天 00:00:00 至当前时间。
            - 本周: 指根据商家在“预约设置”中配置的“每周开始日”（周一或周日）确定的本周第一天的 00:00:00 至当前时间。
            - 本月: 指本月 1 号 00:00:00 至当前时间。
            - 时间基准: 所有时间范围的计算均基于商家在“店铺信息”中配置的“时区”。
        - 数据更新: 数据为准实时更新（具体频率待技术确认，需告知用户）。
        - 空状态: 若所选时间段内无数据则显示提示。

-   页面二- 设置 (Settings - 概览页)
    -   页面布局
        - 页面标题- 设置
        - 权限说明- *此模块下所有功能仅限商户管理员操作。*
        - 设置项列表- [ 店铺信息 ] [ 店铺推广 ] [ 预约设置 ] [ 自定义称谓 ]
    -   功能逻辑
        - 作为设置功能的入口导航。

-   页面三- 设置 - 店铺信息
    -   页面布局
        - 页面标题- 店铺信息
        - 表单- Logo上传, 店铺名称(必填), 联系电话(必填), 店铺地址(必填), 营业时间(选择营业日+设置每日起止时间, 必填), 时区(下拉选择, 必填)。
    -   功能逻辑
        - Logo需校验格式(<2MB, JPG/PNG)和建议尺寸。
        - 电话需校验格式。
        - 营业时间必须至少选择一天，起止时间需合法。
        - 时区需有合理的默认值（如根据注册地判断）。
        - 保存时进行所有必填项和格式校验。

-   页面四- 设置 - 店铺推广
    -   页面布局
        - 页面标题- 店铺推广
        - 内容区- 展示小程序码图片和链接，提供下载/复制按钮。
    -   功能逻辑
        - 首次访问时自动触发后台生成小程序码和链接。生成成功后保存并展示。
        - 后续访问直接展示已保存的结果。


-   页面五：设置 - 预约设置
    -   页面布局
        - 页面标题- (返回按钮) 预约设置
        - 表单-
            - 设置项一：预约时间间隔
                - 标签- 可选预约时间间隔
                - 下拉菜单- [ 15分钟 ] [ 30分钟 ] (默认) [ 60分钟 ]
                - 提示- 顾客可以选择的预约时间点的精度。
            - 设置项二：最早提前预约
                - 标签- 顾客需至少提前 [ 输入框 ] [ 小时/天 ▼ ] 进行预约。
                - 输入框- (数字)
                - 下拉菜单- (单位：小时, 天)
                - 提示- 防止临时预约。0表示无限制。
            - 设置项三：最远可约范围
                - 标签- 顾客最远可预约未来 [ 输入框 ] [ 天/周/月 ▼ ] 内的时间。
                - 输入框- (数字)
                - 下拉菜单- (单位：天, 周, 月)
                - 提示- 限制可预约的未来时间范围。
            - 设置项四：顾客自助取消
                - 标签- 允许顾客在预约开始前 [ 输入框 ] [ 小时/天 ▼ ] 自助取消预约。
                - 输入框- (数字)
                - 下拉菜单- (单位：小时, 天)
                - 提示- 0表示不允许顾客自助取消。
            - 设置项五：每周开始日
                - 标签- 每周开始于
                - 单选按钮组- ( ) 周一 (默认) ( ) 周日
                - 提示- 用于统计报表和日历视图的“本周”定义。
    -   功能逻辑
        - 预约时间间隔:
            - 数据类型: 枚举选择。
            - 选项: 15分钟, 30分钟, 60分钟。
            - 默认值: 30分钟。
        - 最早提前预约:
            - 数据类型: 非负整数。
            - 单位: 小时 或 天。
            - 校验规则: 必须输入非负整数。范围建议 0 - 168 小时 或 0 - 7 天。
            - 默认值: 1 小时。
        - 最远可约范围:
            - 数据类型: 正整数。
            - 单位: 天 或 周 或 月。
            - 校验规则: 必须输入正整数。范围建议 1 - 180 天 或 1 - 26 周 或 1 - 6 个月。
            - 默认值: 30 天。
        - 顾客自助取消时限:
            - 数据类型: 非负整数。
            - 单位: 小时 或 天。
            - 校验规则: 必须输入非负整数。范围建议 0 - 168 小时 或 0 - 7 天。0 表示不允许自助取消。
            - 默认值: 2 小时。
        - 每周开始日:
            - 数据类型: 枚举选择。
            - 选项: 周一, 周日。
            - 默认值: 周一。
        - 保存: 点击`[ 保存 ]`时，对所有输入框的值进行类型、范围校验，校验通过后才可成功保存。
        - 生效: 保存后，这些规则将直接影响顾客端可预约时间段的计算以及取消操作的可用性。


-   页面六- 设置 - 自定义称谓
    -   页面布局
        - 页面标题- 自定义称谓
        - 表单- 列出可自定义项（员工、服务项目、会员）及其输入框。
    -   功能逻辑
        - 输入框限制长度（1-10汉字）。
        - 保存后，系统后台和顾客端小程序的相关显示需同步更新（允许有缓存延迟）。
        - 输入框清空则恢复默认称谓。

#### 核心业务规则

-   权限: “设置”模块下所有功能仅限“商户管理员”访问和操作。“统计”模块可被“商户管理员”和“运营人员”访问。
-   统计口径:
    - 营业额: 已完成预约的服务项目原价总和。
    - 订单数: 已完成的预约数量。
    - 时间基准: 所有统计均基于店铺设置的“时区”和“每周开始日”。
-   配置生效: 所有设置项保存后应尽快在全系统（后台、顾客端）生效，允许合理的缓存更新延迟。
-   推广码/链接: 系统需保证为每个店铺生成唯一的小程序码和链接，并在首次访问推广页面时自动完成生成。
-   营业时间约束规则:
    - 排班约束: 系统不允许创建或保存任何全部或部分时间超出店铺在“店铺信息”中设定的营业时间范围的员工班次（Shift）。
    - 可用性约束: 系统在计算并向顾客端展示可预约时间段时，必须同时满足以下条件：a) 在店铺的营业时间内；b) 在员工的有效排班时间内（且不含休息时段）；c) 满足服务时长、缓冲时间、预约间隔、提前/最远预约等其他预约规则。
    - 数据基础: 此规则确保店铺营业时间是整个预约排班系统的基础时间边界。

#### 成功指标

-   配置完成率: 完成Onboarding的商家中，完成店铺信息（含地址、营业时间、时区）配置的比例 > 95%。
-   规则使用率: 设置了非默认预约规则（如取消时限、提前预约时间等）的商家比例 > 50%。
-   推广工具使用率: 主动下载小程序码或复制链接的商家比例 > 60%。
-   统计查看频率: 活跃商家（有预约记录）中，每周至少查看一次统计页面的比例 > 70%。
